@model _221103018_OmerFarukBayraktutar.Areas.Admin.Controllers.AdminEtkinlikDetayViewModel
@{
    ViewData["Title"] = "Etkinlik Detayƒ±";
    Layout = "_AdminLayout";
}

<div class="container-fluid">
    <div class="row mb-3">
        <div class="col-md-12">
            <a asp-action="Index" asp-controller="Etkinlik" asp-area="Admin" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Listeye D√∂n
            </a>
            <button type="button" class="btn @(Model.Etkinlik.AktifMi ? "btn-danger" : "btn-success")" onclick="durumDegistir(@Model.Etkinlik.EtkinlikId)">
                <i class="fas fa-sync-alt"></i> @(Model.Etkinlik.AktifMi ? "Pasif Yap" : "Aktif Yap")
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Etkinlik Bilgileri</h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <img src="@Model.Etkinlik.ResimYolu" class="img-fluid rounded" alt="@Model.Etkinlik.EtkinlikAdi" style="max-height: 200px;">
                    </div>
                    <h4 class="mb-3">@Model.Etkinlik.EtkinlikAdi</h4>
                    <p class="text-muted">@Model.Etkinlik.Aciklama</p>
                    <hr />
                    <dl class="row">
                        <dt class="col-sm-5">Organizat√∂r:</dt>
                        <dd class="col-sm-7">@(Model.Etkinlik.Organizator?.Ad + " " + Model.Etkinlik.Organizator?.Soyad)</dd>

                        <dt class="col-sm-5">Kategori:</dt>
                        <dd class="col-sm-7">@Model.Etkinlik.Kategori?.KategoriAdi</dd>

                        <dt class="col-sm-5">≈ûehir:</dt>
                        <dd class="col-sm-7">@Model.Etkinlik.Sehir?.SehirAdi</dd>

                        <dt class="col-sm-5">Adres:</dt>
                        <dd class="col-sm-7">@Model.Etkinlik.Adres</dd>

                        <dt class="col-sm-5">Tarih:</dt>
                        <dd class="col-sm-7">@Model.Etkinlik.Tarih.ToShortDateString()</dd>

                        <dt class="col-sm-5">Saat:</dt>
                        <dd class="col-sm-7">@(Model.Etkinlik.BaslangicSaati?.ToString("hh\\:mm")) - @(Model.Etkinlik.BitisSaati?.ToString("hh\\:mm"))</dd>

                        <dt class="col-sm-5">Bilet Fiyatƒ±:</dt>
                        <dd class="col-sm-7">@Model.Etkinlik.BiletFiyati.ToString("C")</dd>

                        <dt class="col-sm-5">Toplam Kapasite:</dt>
                        <dd class="col-sm-7">@Model.Etkinlik.ToplamKapasite</dd>

                        <dt class="col-sm-5">Kalan Kapasite:</dt>
                        <dd class="col-sm-7">@Model.Etkinlik.KalanKapasite</dd>

                        <dt class="col-sm-5">Durum:</dt>
                        <dd class="col-sm-7">
                            @if (Model.Etkinlik.AktifMi)
                            {
                                <span class="badge bg-success">Aktif</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">Pasif</span>
                            }
                        </dd>

                        <dt class="col-sm-5">Olu≈üturulma Tarihi:</dt>
                        <dd class="col-sm-7">@Model.Etkinlik.OlusturulmaTarihi.ToString("dd.MM.yyyy HH:mm")</dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Rezervasyonlar</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover datatable" id="rezervasyonTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>M√º≈üteri</th>
                                    <th>Bilet Sayƒ±sƒ±</th>
                                    <th>Rezervasyon Tarihi</th>
                                    <th>Barkod No</th>
                                    <th>Durum</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.Rezervasyonlar != null && Model.Rezervasyonlar.Any())
                                {
                                    foreach (var rezervasyon in Model.Rezervasyonlar)
                                    {
                                        <tr>
                                            <td>@rezervasyon.RezervasyonId</td>
                                            <td>@(rezervasyon.Kullanici?.Ad + " " + rezervasyon.Kullanici?.Soyad)</td>
                                            <td>@rezervasyon.BiletSayisi</td>
                                            <td>@rezervasyon.RezervasyonTarihi.ToString("dd.MM.yyyy HH:mm")</td>
                                            <td>@rezervasyon.BarkodNo</td>
                                            <td>
                                                @if (rezervasyon.Iptal)
                                                {
                                                    <span class="badge bg-danger">ƒ∞ptal Edildi</span>
                                                }
                                                else if (rezervasyon.Kullanildi)
                                                {
                                                    <span class="badge bg-info">Kullanƒ±ldƒ±</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-success">Aktif</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="6" class="text-center">Hen√ºz rezervasyon bulunmamaktadƒ±r.</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Durum Deƒüi≈ütirme Formu -->
<form id="durumForm" method="post" style="display:none;">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script>
        $(document).ready(function () {
            console.log("üîí Etkinlik Detay sayfasƒ± y√ºklendi");
              // Rezervasyon tablosunu ba≈ülat
            setTimeout(function() {
                const $table = $('#rezervasyonTable');
                if ($table.length && !$.fn.DataTable.isDataTable('#rezervasyonTable')) {
                    try {
                        // Tablonun yapƒ±sƒ±nƒ± kontrol et
                        if ($table.find('thead').length === 0) {
                            console.warn("‚ö†Ô∏è Rezervasyon tablosunda thead bulunamadƒ±");
                            return;
                        }
                        
                        $table.DataTable({
                            "language": {
                                "decimal": "",
                                "emptyTable": "Tabloda veri bulunmamaktadƒ±r",
                                "info": "_TOTAL_ kayƒ±ttan _START_ - _END_ arasƒ±ndaki kayƒ±tlar g√∂steriliyor",
                                "infoEmpty": "Kayƒ±t yok",
                                "infoFiltered": "(_MAX_ kayƒ±t i√ßerisinden bulunan)",
                                "infoPostFix": "",
                                "thousands": ",",
                                "lengthMenu": "_MENU_ kayƒ±t g√∂ster",
                                "loadingRecords": "Y√ºkleniyor...",
                                "processing": "ƒ∞≈üleniyor...",
                                "search": "Ara:",
                                "zeroRecords": "E≈üle≈üen kayƒ±t bulunamadƒ±",
                                "paginate": {
                                    "first": "ƒ∞lk",
                                    "last": "Son",
                                    "next": "Sonraki",
                                    "previous": "√ñnceki"
                                }
                            },
                            "pageLength": 10,
                            "autoWidth": false,
                            "responsive": true
                        });
                        console.log("‚úÖ Rezervasyon tablosu ba≈ülatƒ±ldƒ±");
                    } catch (error) {
                        console.error("‚ùå Rezervasyon tablosu ba≈ülatma hatasƒ±:", error);
                        // Tabloya temel sƒ±nƒ±flarƒ± ekle
                        $table.addClass('table table-striped table-hover');
                    }
                }
            }, 300);
        });

        function durumDegistir(etkinlikId) {
            if (confirm('Etkinlik durumunu deƒüi≈ütirmek istediƒüinizden emin misiniz?')) {
                document.getElementById('durumForm').action = '@Url.Action("DurumDegistir", "Etkinlik", new { area = "Admin" })/' + etkinlikId;
                document.getElementById('durumForm').submit();
            }
        }
    </script>
}